---
title: "Triggering tasks from Supabase edge functions"
sidebarTitle: "Supabase"
description: "This guide will show you how to trigger a task from a Supabase edge function, and then view the run."
icon: "N"
---

import Prerequisites from "/snippets/framework-prerequisites.mdx";
import CliInitStep from "/snippets/step-cli-init.mdx";
import CliDevStep from "/snippets/step-cli-dev.mdx";
import CliRunTestStep from "/snippets/step-run-test.mdx";
import CliViewRunStep from "/snippets/step-view-run.mdx";
import UsefulNextSteps from "/snippets/useful-next-steps.mdx";
import TriggerTaskNextjs from "/snippets/trigger-tasks-nextjs.mdx";
import NextjsTroubleshootingMissingApiKey from "/snippets/nextjs-missing-api-key.mdx";
import NextjsTroubleshootingButtonSyntax from "/snippets/nextjs-button-syntax.mdx";
import WorkerFailedToStartWhenRunningDevCommand from "/snippets/worker-failed-to-start.mdx";

### Overview

In this guide we will set up and deploy a simple Supabase edge function example; it will trigger a task when an edge function URL is accessed. 

Supabase edge functions allow you to trigger tasks when an event is sent from a third party (e.g. a new Stripe payment is processed, a new user signs up, etc), or when there are any changes / updates to your Supabase database.

## Prerequisites

- Setup a project in [Supabase](https://supabase.com/) and have the Supabase CLI installed
- Ensure TypeScript is installed
- [Create a Trigger.dev account](https://cloud.trigger.dev)
- [Create a new Trigger.dev project](/guides/dashboard/creating-a-project)

## Initial setup

<Steps>

<Step title="Run the CLI `init` command">

The easiest way to get started it to use the CLI. It will add Trigger.dev to your existing project, create a `/trigger` folder and give you an example task.

<Note>
If you are using Deno, to install Trigger.dev you must first add a `tsconfig.json` file with these settings to the root directory:
<Accordion title="tsconfig.json file to add">
```json tsconfig.json
{
  "compilerOptions": {
    "allowJs": true,
    "esModuleInterop": true,
    "experimentalDecorators": true,
    "inlineSourceMap": true,
    "isolatedModules": true,
    "jsx": "react",
    "lib": ["esnext"],
    "module": "NodeNext",
    "moduleResolution": "NodeNext",
    "strict": true,
    "target": "esnext",
    "useDefineForClassFields": true
  },
  "exclude": ["node_modules"]
}
```
</Accordion>
</Note>

Run this command in the root of your project to get started:

<CodeGroup>

```bash npm
npx trigger.dev@beta init
```

```bash pnpm
pnpm dlx trigger.dev@beta init
```

```bash yarn
yarn dlx trigger.dev@beta init
```

</CodeGroup>


It will do a few things:

1. Log you into the CLI if you're not already logged in.
2. Create a `trigger.config.ts` file in the root of your project. 
3. Ask where you'd like to create the `/trigger` directory.
4. Create the `/trigger` directory with an example task, `/trigger/example.[ts/js]`. 

Install the "Hello World" example task when prompted. We'll use this task to test the setup.

</Step>
  <CliDevStep />
  <CliRunTestStep />
  <CliViewRunStep />
</Steps>

## Create and a new Supabase edge function and trigger a dev run locally

<Steps>

<Step title="Create a new edge function using the Supabase CLI">

We will call this example function `edge-function-trigger`.

``` bash
supabase functions new edge-function-trigger
```

</Step>

<Step title="Update the edge function code">

Replace the `edge-function-trigger` placeholder code with the following:

```ts edge-function-trigger/index.ts
import "jsr:@supabase/functions-js/edge-runtime.d.ts";
import { tasks } from "npm:@trigger.dev/sdk@3.0.0-beta.55/v3";
// Import your task type from your /trigger folder
import type { helloWorldTask } from "../../../src/trigger/example.ts";

Deno.serve(async (req) => {
  // @ts-expect-error: Ignoring Task type mismatch and RunHandle incompatibility
  await tasks.trigger<typeof helloWorldTask>("edge-function-trigger", "hello");
  return new Response("OK");
});
```

<Note>You can only import the `type` from the task.</Note>
<Note>
  Tasks in the `trigger` folder use Node, so must stay in there or they will not run, especially if
  you are using a different runtime like Deno. Also do not add `npm:` to imports inside your task
  files, for the same reason.
</Note>

</Step>

<Step title="Add a .env file to be able to test locally">

First, go to your Trigger.dev project and copy the `dev` secret key from the API keys page.

![How to find your secret key](/images/api-keys.png)

Then create an .env file in the functions folder, and add your `TRIGGER_SECRET_KEY`.

```ts functions/.env
TRIGGER_SECRET_KEY="your-secret-key"
```

</Step>

<Step title="Test your new edge function locally">

You can now test your edge function locally.

To do this, open up two terminal windows in your project. In the first terminal window run:

<CodeGroup>

```bash npm
npx trigger.dev@beta dev
```

```bash pnpm
pnpm dlx trigger.dev@beta dev
```

```bash yarn
yarn dlx trigger.dev@beta dev
```

</CodeGroup>

The CLI `dev` command runs a server for your tasks. It will watches for changes in your `/trigger` directory and communicates with the Trigger.dev platform to register your tasks, perform runs, and send data back and forth.

And then in the second terminal run this command:

``` bash
supabase functions serve edge-function-trigger
```

Then click the link to open the preview URL, making sure to add your function name to the end:
 




</Step>
<Step title="Add your Trigger.dev secret key">

Now your edge function has been added to your dashboard, you can add your Trigger.dev secret key as an environment variable.

First, go to your Trigger.dev project and copy the `DEV` secret key from the API keys page.

![How to find your secret key](/images/api-keys.png)

Then, navigate to your new edge function in the Supabase dashboard and add a new environment variable with the key `TRIGGER_SECRET_KEY` and the value of your Trigger.dev secret key.

![Add environment variable in Supabase - step 1](/images/supabase-keys-1.png)
![Add environment variable in Supabase - step 2](/images/supabase-keys-2.png)

</Step>

<Step title="Redeploy your edge function">

Redeploy your edge function using the Supabase CLI to update the environment variable:

``` bash
supabase functions serve edge-function-trigger --no-verify-jwt
```

Your new `edge-function-trigger` edge function is now ready to trigger your task.

</Step>

</Steps>

## Create and deploy a new Supabase edge function

<Steps>

<Step title="Create a new edge function using the Supabase CLI">

We will call this example function `edge-function-trigger`.

``` bash
supabase functions new edge-function-trigger
```

</Step>

<Step title="Update the edge function code">

Replace the `edge-function-trigger` placeholder code with the following:

```ts edge-function-trigger/index.ts
import "jsr:@supabase/functions-js/edge-runtime.d.ts";
import { tasks } from "npm:@trigger.dev/sdk@3.0.0-beta.55/v3";
// Import your task from your /trigger folder
import type { helloWorldTask } from "../../../src/trigger/example.ts";

Deno.serve(async (req) => {
  await tasks.trigger<typeof helloWorldTask>("edge-function-trigger", "hello");
  return new Response("OK");
});
```

<Note>You can only import the `type` from the task.</Note>
<Note>
  Tasks in the `trigger` folder use Node, so must stay in there or they will not run, especially if
  you are using a different runtime like Deno. Also do not add `npm:` to imports inside your task
  files, for the same reason.
</Note>

</Step>

<Step title="Deploy your new edge function">


``` bash
supabase functions serve edge-function-trigger --no-verify-jwt
```

<Note>
  `--no-verify-jwt` removes the JSON Web Tokens requirement from the authorization header. By
  default this should be on, but it is not required for this example. Learn more about JWTs
  [here](https://supabase.com/docs/guides/auth/jwts).
</Note>

Follow the CLI instructions and you should now see your new edge function deployment in the Supabase dashboard.


</Step>
<Step title="Add your Trigger.dev secret key">

Now your edge function has been added to your dashboard, you can add your Trigger.dev secret key as an environment variable.

First, go to your Trigger.dev project and copy the `DEV` secret key from the API keys page.

![How to find your secret key](/images/api-keys.png)

Then, navigate to your new edge function in the Supabase dashboard and add a new environment variable with the key `TRIGGER_SECRET_KEY` and the value of your Trigger.dev secret key.

![Add environment variable in Supabase - step 1](/images/supabase-keys-1.png)
![Add environment variable in Supabase - step 2](/images/supabase-keys-2.png)

</Step>

<Step title="Redeploy your edge function">

Redeploy your edge function using the Supabase CLI to update the environment variable:

``` bash
supabase functions serve edge-function-trigger --no-verify-jwt
```

Your new `edge-function-trigger` edge function is now ready to trigger your task.

</Step>

</Steps>

## Triggering your task from your edge function

<Steps>

<Step title="Run the Trigger.dev CLI `dev` command">

<CodeGroup>

```bash npm
npx trigger.dev@beta dev
```

```bash pnpm
pnpm dlx trigger.dev@beta dev
```

```bash yarn
yarn dlx trigger.dev@beta dev
```

</CodeGroup>

</Step>

<Step title="Trigger a dev run">

Open the `edge-function-trigger` URL, you can find this on the dashboard:

![Edge function URL](/images/supabase-function-url.png)

The task will be triggered when your edge function URL is accessed. 

    1. Go to your `edge-function-trigger` edge function page, copy the URL, and paste it into your browser. You should see ‘OK’ on the new screen.
    2. Check the terminal to see if the task has run. You can also check the [cloud.trigger.dev](http://cloud.trigger.dev) dashboard.

    **Congratulations, you have run a simple Hello World example from a Supabase edge function!**

</Step>
</Steps>

## Deploying your task

You can manually deploy your task by running the [CLI deploy command](/cli-deploy) below. Other ways to deploy are listed in the next section.

<CodeGroup>

```bash npm
npx trigger.dev@beta deploy
```

```bash pnpm
pnpm dlx trigger.dev@beta deploy
```

```bash yarn
yarn dlx trigger.dev@beta deploy
```

</CodeGroup>

<Note>
  Update the `TRIGGER_SECRET_KEY` environment variable in Supabase with a new `PROD` secret key
  after deploying. This can be found on the API key page in the web app.
</Note>

### Other ways to deploy

<Tabs>

<Tab title="GitHub Actions">

Use GitHub Actions to automatically deploy your tasks whenever new code is pushed and when the `trigger` directory has changes in it. Follow [this guide](/github-actions) to set up GitHub Actions.

</Tab>

<Tab title="Vercel Integration">

We're working on adding an official [Vercel integration](/vercel-integration) which you can follow the progress of [here](https://feedback.trigger.dev/p/vercel-integration-3).

</Tab>

</Tabs>

<UsefulNextSteps />
